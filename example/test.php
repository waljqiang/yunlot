<?php
require_once __DIR__ . "/../vendor/autoload.php";
use Waljqiang\Yunlot\Yunlot;
try{
	$token = "waljqiang";
	$key = "abcdefghijklmnopqrstuvwxyz0123456789ABCDEFG";
	$str = '{
		"header":{
			"protocol":"v1.0",
			"type":"1",
			"encode":{
				"type":"2",
				"token":"waljqiang",
				"key":"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFG",
				"nonce":"kkzRT4",
				"timestamp":"1587435315",
				"signature":"236245b9505211e1d17d8726353952227f464436"
			}
		},
		"body":"47737664583171306775506866644e394d3679614b3346764c715878674e50674a6d4f4b43362b743544376d73792f77664d5739615051415774592f6b6e4d2f6b422b4752565349525a5a535979714b443573754168484c4f43614a7653455a6d6b5337664b62757a6f71625571573454776b417979563042774d43694934525049585a4967506d612f5a5a4c4532664d58526a624a68414847646a69416f71427a48314f434c2b66373747633675557276785538726e512f544853496e46634570372f70645a3167626c6e714750635861786563593942644839323473783857427445356d38547259614f7667427477504d4e535a44645443327944695744624748624c4a34386454344b7a744e554c366c4e4671714255384c5a4837424774654a547857396b614a552f6d654555754c665432526636374b734d6666686447636456454275612b684f42552f665438564d2b694661533837476d41614e776457444a767632706d3866416130664a63315a4a6b5a2f475a5544475237787a7457564b547a774a45644f4b66336c63726a51667642395a5479624e787539634c4c4a496c557474455843527959366e68442f326465774c415a64366971316e537764622b4f65366659644e734b7257414d44794f4d5639544d752b59547a7339794862412b45512f797259692b4456413931654531516f456d38792f6678796467442f70516c58616243702f783333434d76726e643051543731444e37537a6d42544545393565667a313239447432546f6955745731484747722f366b4253374c63444d43754b6962443959716b59663272365a2f6c2b6431436c794a572b7a65716b36516964386651756947766c63654b38415a6b786d7863687975574167503244517373774b72506178635a664874536f4c4963636f5675506d61784d5551352b647230376734733d",
		"now":"12344566"
	}';
	Yunlot::getInstance()->init("v1.0",['encode' => ['token' => $token,'type' => 'AES','key' => $key]]);
	//Yunlot::getInstance()->setEncode(['encode' => ['token' => $token,'type' => 'AES','key' => $key]]);
	$b = Yunlot::getInstance()->parse($str);
	var_dump($b);

	$nonce = "abcdef";
	$timeStamp = "1587440903";
	Yunlot::getInstance()->setHeader("1",["type" => "2","token" => $token,"key" => $key]);
	Yunlot::getInstance()->setBody([
		"active" => [
			'name' => 'CPE120M',
	      	'chip' => 'RTL8197F-FR350',
	      	'cpu' => '1GHz',
	      	'flash' => '8',
	      	'ram' => '64',
	      	'mac' => '44:D1:FA:7B:FB:38',
	      	'version' => 'CPE120M-CPE-V2.0-Build20190927134132',
      		'location' => [
          		'lat' => '36.60332',
          		'lng' => '109.50051'
          	]
		]
	],$nonce,$timeStamp);
	Yunlot::getInstance()->setNow($timeStamp);
	var_dump(Yunlot::getInstance()->out());
}catch(\Exception $e){
	var_dump($e);
}